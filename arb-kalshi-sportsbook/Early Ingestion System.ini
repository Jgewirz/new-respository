
  1. Architecture Overview

  - Visual diagram of data flow: Kalshi WS → ILP → QuestDB → Arb Detector
  - Redis hot cache vs QuestDB cold storage roles

  2. Data Flow & Logic

  Kalshi WebSocket → ILP Write → QuestDB → SQL Query → Arb Detection
       ↓                                        ↓
  Redis (hot cache)                    Log Opportunity

  3. Key SQL Patterns
  ┌─────────────────────────────────────────┬────────────────────────────┐
  │                 Pattern                 │          Use Case          │
  ├─────────────────────────────────────────┼────────────────────────────┤
  │ LATEST ON timestamp PARTITION BY ticker │ Real-time price lookup     │
  ├─────────────────────────────────────────┼────────────────────────────┤
  │ SAMPLE BY 5s                            │ Time-bucketed aggregations │
  ├─────────────────────────────────────────┼────────────────────────────┤
  │ dateadd('m', -1, now())                 │ Time-bounded queries       │
  └─────────────────────────────────────────┴────────────────────────────┘
  4. Arbitrage Detection Queries

  - Edge calculation: (book_prob - kalshi_prob) * 100
  - Cross-source joins between kalshi_ticks and sportsbook_odds
  - Opportunity persistence detection (noise reduction)

  5. Performance Guidelines

  - Write path: Batch ILP writes, keep connection open
  - Query path: Always use time filters, prefer LATEST ON over ORDER BY
  - Schema: Use SYMBOL for low-cardinality strings

  6. Integration Points

  - WebSocket consumer → QuestDB write hooks
  - Arb detector → Query + write flow
  - Redis ↔ QuestDB synchronization strategy

  7. Complete Code Example

  Full async arbitrage detection loop with:
  - Query latest prices from both sources
  - Calculate edges
  - Log opportunities
  - Notify execution layer
  ┌─────────────────────────────────────────────────────────────────────────┐
│                         KALSHI ARB SYSTEM                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌──────────────┐     ┌──────────────┐     ┌──────────────────────┐    │
│  │  Kalshi WS   │────▶│    Redis     │────▶│   Strategy Engine    │    │
│  │  Order Book  │     │  (Real-time) │     │                      │    │
│  └──────────────┘     │              │     │  • Spread Arb        │    │
│                       │  • Order Book│     │  • Cross-Market      │    │
│  ┌──────────────┐     │  • Positions │     │  • Statistical       │    │
│  │  Kalshi REST │────▶│  • Signals   │     │  • Mean Reversion    │    │
│  │  API         │     └──────────────┘     └──────────┬───────────┘    │
│  └──────────────┘            │                        │                │
│                              │                        ▼                │
│  ┌──────────────┐     ┌──────────────┐     ┌──────────────────────┐    │
│  │   QuestDB    │◀────│  Analytics   │◀────│   Execution Engine   │    │
│  │ (Historical) │     │   Worker     │     │                      │    │
│  │              │     └──────────────┘     │  • Atomic Orders     │    │
│  │ • Tick Data  │                          │  • Risk Checks       │    │
│  │ • Spreads    │                          │  • Position Mgmt     │    │
│  │ • PnL        │                          └──────────────────────┘    │
│  └──────────────┘                                                      │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘